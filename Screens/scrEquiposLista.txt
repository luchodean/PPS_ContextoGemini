Screens:
  scrEquiposLista:
    Properties:
      Fill: =locTema_FondoPagina
      LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
      OnVisible: "=// 1. Mostrar Spinner y Guardar Navegación\r\nSet(varEnProcesoDeCarga, true);\r\nSet(varActiveId, LookUp(colNav, Screen = App.ActiveScreen).Id);\r\n\r\n// 2. Cargar Maestros en Caché (Para evitar N+1 LookUps)\r\nConcurrent(\r\n    ClearCollect(colCacheUbicaciones, spUbicaciones),\r\n    ClearCollect(colCacheTipos, spCatalogosTiposEquipo)\r\n);\r\n\r\n// 3. Cargar Equipos \"Enriquecidos\"\r\n// APLICAMOS FILTRO 4 AQUI: No traemos borradores a la memoria\r\nClearCollect(colEquiposLista,\r\n    DropColumns(\r\n        AddColumns(\r\n            Filter(spEquipos, EsBorrador = false), \r\n            \r\n            // Agregamos columnas de texto plano para búsqueda rápida\r\n            NombreSector, LookUp(colCacheUbicaciones, ID = SectorID).Title,\r\n            NombreLinea,  LookUp(colCacheUbicaciones, ID = LineaID).Title,\r\n            NombreTipo,   LookUp(colCacheTipos, ID = TipoEquipoID).Title\r\n        ),\r\n        // Limpiamos basura de SP para ahorrar RAM\r\n        Author, Editor, ComplianceAssetId, OData__ColorTag\r\n    )\r\n);\r\n\r\nSet(varEnProcesoDeCarga, false);"
    Children:
      - cmpHeader_EquiposLista:
          Control: CanvasComponent
          ComponentName: cmpHeader
          Properties:
            Fill: =RGBA(42, 47, 56, 1)
            Height: =70
            LongitudHorizontal: =700
            TriggerReset: =true
            Width: =Parent.Width
      - cmpHeaderSeccion_EquiposLista:
          Control: CanvasComponent
          ComponentName: cmpHeaderSeccion
          Properties:
            Fill: =Color.Transparent
            Height: =80
            Subtitle: =LookUp(colNav, Id = varActiveId).Breadcrumb
            Title: =LookUp(colNav, Id = varActiveId).PageTitle
            Width: =App.Width - cmpSidebar_EquiposLista.Width
            X: =cmpSidebar_EquiposLista.Width
            Y: =cmpHeader_EquiposLista.Height
      - cmpSidebar_EquiposLista:
          Control: CanvasComponent
          ComponentName: cmpSidebar
          Properties:
            Fill: =Color.Transparent
            Height: =App.Height - cmpHeader_EquiposLista.Height
            Navegacion: =
            Width: =If(varMenuCompacto, 85, 265)
            Y: =cmpHeader_EquiposLista.Height
      - conMain_EquiposLista:
          Control: GroupContainer@1.4.0
          Variant: AutoLayout
          Properties:
            Fill: =locTema_FondoPanel
            Height: =cmpSidebar_EquiposLista.Height - cmpHeaderSeccion_EquiposLista.Height
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =10
            PaddingBottom: =8
            PaddingLeft: =8
            PaddingRight: =8
            PaddingTop: =8
            Width: =cmpHeaderSeccion_EquiposLista.Width
            X: =cmpSidebar_EquiposLista.Width
            Y: =cmpHeaderSeccion_EquiposLista.Y + cmpHeaderSeccion_EquiposLista.Height
          Children:
            - conBarraSuperior_EquiposLista:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  AlignInContainer: =AlignInContainer.Center
                  Fill: =locColorGris100
                  FillPortions: =0
                  Height: =80
                  LayoutMaxHeight: =
                  LayoutMaxWidth: =
                  Width: =Parent.Width
                  Y: =28
                Children:
                  - btnNuevo_EquiposLista:
                      Control: Classic/Button@2.2.0
                      Properties:
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        Color: =RGBA(255, 255, 255, 1)
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        DisabledFill: =RGBA(242, 242, 241, 0)
                        Fill: =Color.Green
                        Font: =Font.'Segoe UI'
                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                        HoverColor: '=Color.White '
                        HoverFill: =ColorFade(Self.Fill, -20%)
                        OnSelect: |-
                          =// Navegamos al formulario en modo NUEVO (sin registro)
                          Navigate(scrEquiposGestionarEquipo, ScreenTransition.Fade, { locRegistroEditar: Blank(), locModoVista: "Nuevo", locCodigoPreview: "---" })
                        PaddingBottom: =8
                        PressedBorderColor: =RGBA(0, 69, 120, 1)
                        PressedColor: =RGBA(255, 255, 255, 1)
                        PressedFill: =RGBA(16, 110, 190, 1)
                        RadiusBottomLeft: =6
                        RadiusBottomRight: =6
                        RadiusTopLeft: =6
                        RadiusTopRight: =6
                        Text: ="+ Nuevo Equipo"
                        Width: =180
                        X: =Parent.Width - Self.Width - 20
                        Y: =txtBuscador_Usuarios.Y
                  - icnLupa_EquiposLista:
                      Control: Classic/Icon@2.5.0
                      Properties:
                        BorderColor: =RGBA(0, 0, 0, 0)
                        Color: =locColorGris500
                        DisabledBorderColor: =RGBA(245, 245, 245, 1)
                        DisabledColor: =RGBA(225, 223, 221, 1)
                        DisabledFill: =RGBA(0, 0, 0, 0)
                        FocusedBorderThickness: =4
                        Height: =24
                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                        HoverColor: =RGBA(16, 110, 190, 1)
                        HoverFill: =RGBA(0, 0, 0, 0)
                        Icon: =Icon.Search
                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                        PressedColor: =RGBA(16, 110, 190, 1)
                        PressedFill: =RGBA(0, 0, 0, 0)
                        Width: =24
                        X: =20
                        Y: =28
                  - txtBuscador_EquiposLista:
                      Control: TextInput@0.0.54
                      Properties:
                        Fill: =Color.White
                        OnChange: =true
                        Placeholder: ="Buscar por código, nombre o marca..."
                        TriggerOutput: ="Keypress"
                        Width: =200
                        X: =icnLupa_EquiposLista.X + icnLupa_EquiposLista.Width + 10
                        Y: =24
                  - tglMostrarInactivos:
                      Control: Toggle@1.1.5
                      Properties:
                        Label: ="Mostrar Inactivos"
                        LabelPosition: ='Toggle.LabelPosition'.After
                        Width: =200
                        X: =btnNuevo_EquiposLista.X - Self.Width - 10
                        Y: =Parent.Height/2 - Self.Height/2
                  - ddFiltro_Sector:
                      Control: DropDown@0.0.45
                      Properties:
                        Appearance: ='DropdownCanvas.Appearance'.Outline
                        DefaultSelectedItems: |-
                          =[{ Title: "Todos los Sectores", ID: 0 }]
                        Items: "=Ungroup(\r\n    Table(\r\n        // 1. Opción \"Todos\" (Usamos -1 para que no choque con el ID 0 de la base de datos)\r\n        { _registros: Table({ Title: \"Todos los Sectores\", ID: -1 }) },\r\n        \r\n        // 2. Opción \"No Asignado\" (Usamos 0, porque así se guardan los equipos sin sector)\r\n        { _registros: Table({ Title: \"No Asignado\", ID: 0 }) },\r\n\r\n        // 3. Datos dinámicos de SharePoint (Sectores reales, IDs > 0)\r\n        { _registros: ShowColumns(Filter(spUbicaciones, PadreID = 0, Activo = true), Title, ID) }\r\n    ), \r\n    _registros\r\n)"
                        Width: =200
                        X: =txtBuscador_EquiposLista.X + txtBuscador_EquiposLista.Width + 10
                        Y: =txtBuscador_EquiposLista.Y
                      Children:
                        - Title2:
                            Control: DropDownDataField@1.5.0
                            Variant: textualColumn
                            IsLocked: true
                            Properties:
                              FieldDisplayName: ="Title"
                              FieldName: ="Title"
                              FieldType: ="s"
                              Order: =1
                        - PadreID1:
                            Control: DropDownDataField@1.5.0
                            Variant: textualColumn
                            IsLocked: true
                            Properties:
                              FieldDisplayName: ="PadreID"
                              FieldName: ="PadreID"
                              FieldType: ="n"
                              Order: =2
                        - Activo2:
                            Control: DropDownDataField@1.5.0
                            Variant: textualColumn
                            IsLocked: true
                            Properties:
                              FieldDisplayName: ="Activo"
                              FieldName: ="Activo"
                              FieldType: ="b"
                              Order: =3
                        - Attachments2:
                            Control: DropDownDataField@1.5.0
                            Variant: textualColumn
                            IsLocked: true
                            Properties:
                              FieldDisplayName: ="Attachments"
                              FieldName: ="{Attachments}"
                              FieldType: ="r*"
                              Order: =4
            - conEncabezados_EquiposLista:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  Fill: =locColorGris100
                  FillPortions: =0
                  Height: =50
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutMinHeight: =16
                  LayoutMinWidth: =16
                  PaddingLeft: =8
                  PaddingRight: =10
                  Width: =Parent.Width
                  X: =40
                  Y: =40
                Children:
                  - lblEncabezado1_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =locColorGris700
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        FillPortions: =1
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        LayoutMinWidth: =100
                        Text: ="CÓDIGO"
                        X: =20
                  - lblEncabezado2_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =locColorGris700
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        FillPortions: =1
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        Text: ="EQUIPO"
                        X: =lblEncabezado1_EquiposLista.X + lblEncabezado1_EquiposLista.Width
                  - lblEncabezado3_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =locColorGris700
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        FillPortions: =1
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        Text: ="SECTOR"
                        X: =lblEncabezado2_EquiposLista.X + lblEncabezado2_EquiposLista.Width
                  - lblEncabezado4_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =locColorGris700
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        FillPortions: =1
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        Text: ="SUBSECTOR"
                        X: =lblEncabezado2_EquiposLista.X + lblEncabezado2_EquiposLista.Width
                  - lblEncabezado5_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =locColorGris700
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        FillPortions: =1
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        Text: ="ESTADO"
                        X: =lblEncabezado2_EquiposLista.X + lblEncabezado2_EquiposLista.Width
                  - lblAcciones_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =locColorGris700
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =Parent.Height
                        LayoutMaxHeight: =
                        LayoutMaxWidth: =
                        Text: ="ACCIÓN"
                        Width: =180
                        X: =lblEncabezado2_EquiposLista.X + lblEncabezado2_EquiposLista.Width
            - galEquiposLista:
                Control: Gallery@2.15.0
                Variant: BrowseLayout_Vertical_TwoTextOneImageVariant_ver5.0
                Properties:
                  BorderColor: =RGBA(245, 245, 245, 1)
                  Items: "=SortByColumns(\r\n    Search(\r\n        Filter(colEquiposLista,\r\n            // 1. Filtros (Inactivos y Sector) - Sin cambios\r\n            (tglMostrarInactivos.Checked || Activo = true) &&\r\n            (\r\n                ddFiltro_Sector.Selected.ID = -1 || \r\n                SectorID = ddFiltro_Sector.Selected.ID\r\n            )\r\n        ),\r\n        // 2. BUSCADOR\r\n        txtBuscador_EquiposLista.Value,\r\n        \r\n        // --- CAMBIO 1: PRIORIDAD DE BÚSQUEDA ---\r\n        // Ponemos primero el Código para que el buscador lo priorice\r\n        CodigoEquipo,   \r\n        Title,          // Luego el Nombre\r\n        Marca,          \r\n        NombreSector,   \r\n        NombreLinea     \r\n    ),\r\n    // --- CAMBIO 2: ORDENAMIENTO ---\r\n    // Ordenamos la lista por Código en lugar de por Nombre\r\n    \"Title\", \r\n    SortOrder.Ascending\r\n)"
                  LayoutMinHeight: =0
                  LayoutMinWidth: =0
                  TemplateFill: =If(ThisItem.IsSelected, locColorGris200, locTema_TablaFondoRow)
                  TemplateSize: =60
                  Width: =conEncabezados_EquiposLista.Width
                Children:
                  - conFila_EquiposLista:
                      Control: GroupContainer@1.4.0
                      Variant: AutoLayout
                      Properties:
                        Fill: =Color.White
                        Height: =Parent.TemplateHeight
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        PaddingBottom: =8
                        PaddingLeft: =8
                        PaddingRight: =8
                        PaddingTop: =8
                        Width: =Parent.Width
                      Children:
                        - lblCampo1_EquiposLista:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =locColorGris700
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FillPortions: =1
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              LayoutMaxHeight: =
                              LayoutMaxWidth: =
                              LayoutMinWidth: =100
                              Text: =ThisItem.CodigoEquipo
                              X: =20
                        - lblCampo2_EquiposLista:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =locColorGris700
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FillPortions: =1
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              LayoutMaxHeight: =
                              LayoutMaxWidth: =
                              LayoutMinWidth: =100
                              Text: =ThisItem.Title
                              X: =20
                        - lblCampo3_EquiposLista:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =locColorGris700
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FillPortions: =1
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              LayoutMaxHeight: =
                              LayoutMaxWidth: =
                              LayoutMinWidth: =100
                              Text: =Coalesce(LookUp(spUbicaciones, ID = ThisItem.SectorID).Title, "No Asignado")
                              X: =20
                        - lblCampo4_EquiposLista:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              BorderThickness: =2
                              Color: =locColorGris700
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              FillPortions: =1
                              FocusedBorderThickness: =4
                              Font: =Font.'Segoe UI'
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              LayoutMaxHeight: =
                              LayoutMaxWidth: =
                              LayoutMinWidth: =100
                              Text: =ThisItem.NombreLinea
                              X: =20
                        - conEstado_Galeria:
                            Control: GroupContainer@1.4.0
                            Variant: AutoLayout
                            Properties:
                              Fill: =Color.Transparent
                              Height: =Parent.Height
                              LayoutAlignItems: =LayoutAlignItems.Center
                              LayoutDirection: =LayoutDirection.Horizontal
                              LayoutGap: =10
                              LayoutJustifyContent: =LayoutJustifyContent.Center
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              PaddingBottom: =8
                              PaddingLeft: =8
                              PaddingRight: =8
                              PaddingTop: =8
                            Children:
                              - shpEstado_Indicador:
                                  Control: Circle@2.3.0
                                  Properties:
                                    AlignInContainer: =AlignInContainer.Center
                                    BorderColor: =RGBA(245, 245, 245, 1)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    DisabledFill: =RGBA(0, 120, 212, 1)
                                    Fill: |-
                                      =Switch(
                                          ddEstado_Galeria.Selected.Value,
                                          "Operativo", locColorExito,              // Verde
                                          "En Mantenimiento", locColorAdvertencia, // Amarillo/Naranja
                                          "Fuera de Servicio", locColorPeligro,    // Rojo
                                          "Baja", locColorPeligro,                 // Rojo
                                          locColorGris400                          // Default (Gris)
                                      )
                                    Height: =12
                                    HoverFill: =RGBA(0, 120, 212, 1)
                                    LayoutMinHeight: =16
                                    LayoutMinWidth: =16
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    Width: =12
                              - ddEstado_Galeria:
                                  Control: DropDown@0.0.45
                                  Properties:
                                    Appearance: ='DropdownCanvas.Appearance'.FilledLighter
                                    BasePaletteColor: =locTema_TextoPrincipal
                                    DefaultSelectedItems: =[ThisItem.EstadoOperativo]
                                    DisplayMode: |-
                                      =If(
                                          locGuardandoEstado, 
                                          DisplayMode.Disabled, 
                                          DisplayMode.Edit
                                      )
                                    Fill: =Color.Transparent
                                    Items: |-
                                      =If(
                                          !ThisItem.Activo, 
                                          ["Baja"], // Si está inactivo, la única opción visible es "Baja"
                                          lstMaestro_EstadosEquipo // Si está activo, las opciones normales
                                      )
                                    LayoutMinHeight: =16
                                    LayoutMinWidth: =16
                                    OnChange: |-
                                      =// 1. Bloqueamos el control
                                      UpdateContext({ locGuardandoEstado: true });

                                      // 2. Ejecutamos el guardado seguro
                                      Patch(
                                          spEquipos, 
                                          LookUp(spEquipos, ID = ThisItem.ID), 
                                          { EstadoOperativo: Self.Selected.Value }
                                      );

                                      // 3. Liberamos el control
                                      UpdateContext({ locGuardandoEstado: false });
                                    Width: =Parent.Width - 50
                        - conAcciones_EquiposLista:
                            Control: GroupContainer@1.4.0
                            Variant: AutoLayout
                            Properties:
                              AlignInContainer: =AlignInContainer.Center
                              DropShadow: =DropShadow.None
                              FillPortions: =0
                              Height: =Parent.Height
                              LayoutAlignItems: =LayoutAlignItems.Center
                              LayoutDirection: =LayoutDirection.Horizontal
                              LayoutGap: =15
                              LayoutJustifyContent: =LayoutJustifyContent.Center
                              LayoutMinHeight: =0
                              LayoutMinWidth: =16
                              Width: =lblAcciones_EquiposLista.Width
                            Children:
                              - icnDetalles_ListaEquipos:
                                  Control: Classic/Icon@2.5.0
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =Color.Blue
                                    DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                    DisabledColor: =RGBA(225, 223, 221, 1)
                                    DisabledFill: =RGBA(0, 0, 0, 0)
                                    FocusedBorderThickness: =4
                                    Height: =24
                                    HoverBorderColor: =RGBA(0, 0, 0, 0)
                                    HoverColor: =RGBA(16, 110, 190, 1)
                                    HoverFill: =RGBA(0, 0, 0, 0)
                                    Icon: =Icon.View
                                    LayoutMinHeight: =16
                                    LayoutMinWidth: =16
                                    OnSelect: "=// Navega a la pantalla 3.2 (Lectura)\r\nNavigate(\r\n    scrEquiposFichaIndividual, \r\n    ScreenTransition.Fade, \r\n    { \r\n        // 1. Pasamos el registro\r\n        locRegistroVisualizar: ThisItem,\r\n        \r\n        // 2. LA SOLUCIÓN: Forzamos la pestaña ANTES de entrar\r\n        locTabFicha: \"RESUMEN\" \r\n    }\r\n)"
                                    PressedBorderColor: =RGBA(0, 0, 0, 0)
                                    PressedColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 0, 0, 0)
                                    Tooltip: ="Ver detalles"
                                    Width: =24
                              - icnEditar_ListaEquipos:
                                  Control: Classic/Icon@2.5.0
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =locTema_IconoEditar
                                    DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                    DisabledColor: =RGBA(225, 223, 221, 1)
                                    DisabledFill: =RGBA(0, 0, 0, 0)
                                    DisplayMode: =If(ThisItem.Activo, DisplayMode.Edit, DisplayMode.Disabled)
                                    FocusedBorderThickness: =4
                                    Height: =24
                                    HoverBorderColor: =RGBA(0, 0, 0, 0)
                                    HoverColor: =RGBA(16, 110, 190, 1)
                                    HoverFill: =RGBA(0, 0, 0, 0)
                                    Icon: =Icon.Edit
                                    LayoutMinHeight: =0
                                    LayoutMinWidth: =0
                                    OnSelect: |-
                                      =// Navega a la pantalla 3.3 (Escritura) en modo EDICIÓN
                                      Navigate(scrEquiposGestionarEquipo, ScreenTransition.Fade, { 
                                          locModoVista: "Editar",
                                          locRegistroEditar: ThisItem 
                                      })
                                    PressedBorderColor: =RGBA(0, 0, 0, 0)
                                    PressedColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 0, 0, 0)
                                    Tooltip: ="Editar Equipo"
                                    Width: =24
                              - icnBorrar_ListaEquipos:
                                  Control: Classic/Icon@2.5.0
                                  Properties:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    Color: =If(ThisItem.Activo, locTema_IconoBorrar, locColorExito)
                                    DisabledBorderColor: =RGBA(245, 245, 245, 1)
                                    DisabledColor: =RGBA(225, 223, 221, 1)
                                    DisabledFill: =RGBA(0, 0, 0, 0)
                                    FocusedBorderThickness: =4
                                    Height: =24
                                    HoverBorderColor: =RGBA(0, 0, 0, 0)
                                    HoverColor: =RGBA(16, 110, 190, 1)
                                    HoverFill: =RGBA(0, 0, 0, 0)
                                    Icon: =If(ThisItem.Activo, Icon.Trash, Icon.Reload)
                                    LayoutMinHeight: =0
                                    LayoutMinWidth: =0
                                    OnSelect: |-
                                      =If(ThisItem.Activo,
                                          // CASO 1: ESTÁ ACTIVO -> PEDIR CONFIRMACIÓN PARA BORRAR
                                          UpdateContext({ 
                                              locMostrarConfirmacion: true, 
                                              locRegistroParaBorrar: ThisItem 
                                          }),

                                          // CASO 2: ESTÁ INACTIVO -> RESTAURAR INMEDIATAMENTE
                                          Patch(spEquipos, LookUp(spEquipos, ID = ThisItem.ID), { Activo: true });
                                          Notify("Equipo restaurado correctamente", NotificationType.Success)
                                      )
                                    PressedBorderColor: =RGBA(0, 0, 0, 0)
                                    PressedColor: =RGBA(16, 110, 190, 1)
                                    PressedFill: =RGBA(0, 0, 0, 0)
                                    Tooltip: =If(ThisItem.Activo, "Dar de baja", "Restaurar")
                                    Width: =24
      - conOverlayTotal_EquiposLista:
          Control: GroupContainer@1.4.0
          Variant: AutoLayout
          Properties:
            Fill: =locTema_FondoOverlay
            Height: =Parent.Height
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutDirection: =LayoutDirection.Vertical
            LayoutJustifyContent: =LayoutJustifyContent.Center
            PaddingBottom: =8
            PaddingLeft: =8
            PaddingRight: =8
            PaddingTop: =8
            Visible: |
              =locMostrarConfirmacion
            Width: =Parent.Width
          Children:
            - conTarjetaConfirmacion_EquiposLista:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.Center
                  BorderColor: =RGBA(200, 200, 200, 1)
                  BorderThickness: =1
                  DropShadow: =DropShadow.Bold
                  Fill: =Color.White
                  FillPortions: =0
                  Height: =250
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Vertical
                  LayoutGap: =15
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  LayoutMinHeight: =16
                  LayoutMinWidth: =16
                  PaddingBottom: =20
                  PaddingLeft: =20
                  PaddingRight: =20
                  PaddingTop: =20
                  RadiusBottomLeft: =10
                  RadiusBottomRight: =10
                  RadiusTopLeft: =10
                  RadiusTopRight: =10
                  Visible: =locMostrarConfirmacion
                  Width: =450
                Children:
                  - lblTituloConfirmacion_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =RGBA(50, 49, 48, 1)
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        Fill: =RGBA(245, 245, 245, 1)
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        FontWeight: =FontWeight.Bold
                        Height: =50
                        LayoutMinHeight: =16
                        LayoutMinWidth: =16
                        Size: =16
                        Text: ="Confirmar Eliminación"
                        Width: =Parent.Width
                  - lblMensajeConfirmacion_EquiposLista:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        BorderColor: =RGBA(0, 0, 0, 0)
                        BorderStyle: =BorderStyle.None
                        BorderThickness: =2
                        Color: =RGBA(50, 49, 48, 1)
                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                        DisabledColor: =RGBA(161, 159, 157, 1)
                        FocusedBorderThickness: =4
                        Font: =Font.'Segoe UI'
                        Height: =110
                        LayoutMinHeight: =16
                        LayoutMinWidth: =16
                        Text: |-
                          ="¿Está seguro que desea dar de baja '" & 
                          locRegistroParaBorrar.Title & 
                          "'?"
                        Width: =Parent.Width - 40
                        X: =20
                        Y: =60
                  - conBotonesConfirmacion_EquiposLista:
                      Control: GroupContainer@1.4.0
                      Variant: AutoLayout
                      Properties:
                        AlignInContainer: =AlignInContainer.Center
                        FillPortions: =0
                        Height: =60
                        LayoutAlignItems: =LayoutAlignItems.Center
                        LayoutDirection: =LayoutDirection.Horizontal
                        LayoutGap: =20
                        LayoutJustifyContent: =LayoutJustifyContent.Center
                        LayoutMinHeight: =16
                        LayoutMinWidth: =16
                        PaddingBottom: =8
                        PaddingLeft: =8
                        PaddingRight: =8
                        PaddingTop: =8
                        Width: =Parent.Width
                      Children:
                        - btnConfirmarBorrado_EquiposLista:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              Color: =Color.White
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              DisabledFill: =RGBA(242, 242, 241, 0)
                              Fill: =RGBA(220, 53, 69, 1)
                              Font: =Font.'Segoe UI'
                              HoverBorderColor: =RGBA(0, 0, 0, 0)
                              HoverColor: =RGBA(255, 255, 255, 1)
                              HoverFill: =ColorFade(Self.Fill, -20%)
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |-
                                =// 1. Ejecutar Soft Delete seguro
                                Patch(
                                    spEquipos, 
                                    LookUp(spEquipos, ID = locRegistroParaBorrar.ID), 
                                    { 
                                        Activo: false,
                                        EstadoOperativo: "Baja"
                                    }
                                );

                                // 2. Notificación y Cierre
                                Notify("El equipo ha sido dado de baja correctamente.", NotificationType.Success);
                                UpdateContext({ 
                                    locMostrarConfirmacion: false, 
                                    locRegistroParaBorrar: Blank() 
                                });
                              PressedBorderColor: =RGBA(0, 69, 120, 1)
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(16, 110, 190, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Text: ="Eliminar"
                              Width: =180
                              X: =240
                              Y: =190
                        - btnCancelarBorrado_EquiposLista:
                            Control: Classic/Button@2.2.0
                            Properties:
                              BorderColor: =RGBA(0, 0, 0, 0)
                              BorderStyle: =BorderStyle.None
                              Color: =If(Self.Fill = RGBA(230, 230, 230, 1), Color.Black, Color.White)
                              DisabledBorderColor: =RGBA(0, 0, 0, 0)
                              DisabledColor: =RGBA(161, 159, 157, 1)
                              DisabledFill: =RGBA(242, 242, 241, 0)
                              Fill: =RGBA(169, 169, 169, 1)
                              Font: =Font.'Segoe UI'
                              HoverBorderColor: =RGBA(0, 0, 0, 0)
                              HoverColor: =RGBA(255, 255, 255, 1)
                              HoverFill: =ColorFade(Self.Fill, -20%)
                              LayoutMinHeight: =16
                              LayoutMinWidth: =16
                              OnSelect: |-
                                =UpdateContext({ 
                                    locMostrarConfirmacion: false, 
                                    locRegistroParaBorrar: Blank() 
                                });
                              PressedBorderColor: =RGBA(0, 69, 120, 1)
                              PressedColor: =RGBA(255, 255, 255, 1)
                              PressedFill: =RGBA(16, 110, 190, 1)
                              RadiusBottomLeft: =0
                              RadiusBottomRight: =0
                              RadiusTopLeft: =0
                              RadiusTopRight: =0
                              Text: ="Cancelar"
                              Width: =180
                              X: =30
                              Y: =190
